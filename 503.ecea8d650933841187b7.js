"use strict";(self.webpackChunkUlbiTV_frontend=self.webpackChunkUlbiTV_frontend||[]).push([[503],{711:function(e,a,s){s.r(a),s.d(a,{default:function(){return Z}});var t=s(3184),i=s(5443),r=s(3007),n=s(9457),c=s(8699);const l=s(6628).p.injectEndpoints({endpoints:e=>({getArticleRecommendationsList:e.query({query:e=>({url:"/articles",params:{_limit:e}})})})}).useGetArticleRecommendationsListQuery;var d=s(5893);const o=e=>{let{className:a}=e;const{t:s}=(0,i.$)(),{data:o,error:m,isLoading:x}=l(3);return x||m||!o?null:(0,d.jsxs)(n.g,{gap:"8",className:(0,r.A)("",{},[a]),children:[(0,d.jsx)(c.xv,{size:c.yH.L,title:s("Рекоммендуем")}),(0,d.jsx)(t.wD,{articles:o,isLoading:x,wrap:t.im.NO_WRAP,target:"_blank"})]})};var m=s(7294),x=s(9250),u=s(1233),g=s(8979),h=s(5173),j=s(4268);const p=(0,j.hg)("articlesDetailsPage/fetchArticleRecommendations",(async(e,a)=>{const{extra:s,rejectWithValue:t}=a;try{const e=await s.api.get("/articles",{params:{_limit:4}});if(!e.data)throw new Error;return e.data}catch(e){return t("error")}})),v=(0,j.HF)({selectId:e=>e.id}),N=(v.getSelectors((e=>e.articleDetailsPage?.recommendations||v.getInitialState())),(0,j.oM)({name:"articleDetailsPageRecommendationsSlice",initialState:v.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:e=>{e.addCase(p.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(p.fulfilled,((e,a)=>{e.isLoading=!1,v.setAll(e,a.payload)})).addCase(p.rejected,((e,a)=>{e.error=a.payload,e.isLoading=!1}))}})),{reducer:f}=N,w=(0,j.hg)("articleDetails/fetchCommentsByArticleId",(async(e,a)=>{const{extra:s,rejectWithValue:t}=a;if(!e)return t("error");try{const a=await s.api.get("/comments",{params:{articleId:e,_expand:"user"}});if(!a.data)throw new Error;return a.data}catch(e){return t("error")}})),L=(0,j.HF)({selectId:e=>e.id}),A=L.getSelectors((e=>e.articleDetailsPage?.comments||L.getInitialState())),C=(0,j.oM)({name:"articleDetailsCommentsSlice",initialState:L.getInitialState({isLoading:!1,error:void 0,ids:["1","2"],entities:{1:{id:"1",text:"comment 1",user:{id:"1",username:"ulbi tv",avatar:"https://logowik.com/content/uploads/images/homer-simpson4924.jpg"}},2:{id:"2",text:"comment 2",user:{id:"1",username:"ulbi tv",avatar:"https://static.standard.co.uk/s3fs-public/thumbnails/image/2016/02/17/10/homersimpson1702a.jpg?width=1200"}}}}),reducers:{},extraReducers:e=>{e.addCase(w.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(w.fulfilled,((e,a)=>{e.isLoading=!1,L.setAll(e,a.payload)})).addCase(w.rejected,((e,a)=>{e.error=a.payload,e.isLoading=!1}))}}),{reducer:y}=C,b=(0,h.UY)({recommendations:f,comments:y});var k="zeufDxEw",I="a77HKTJF",S=s(9499),D=s(1992),z=s(2222),U=s(919);const P=(0,z.P1)(t.wq,U.m5,((e,a)=>!(!e||!a)&&e.user.id===a.id));var O=s(776);const R=e=>{let{className:a}=e;const{t:s}=(0,i.$)(),c=(0,x.s0)(),l=(0,D.v9)(P),o=(0,D.v9)(t.wq),u=(0,m.useCallback)((()=>{c((0,O.k7)())}),[c]),g=(0,m.useCallback)((()=>{o&&c((0,O.mK)(o.id))}),[o,c]);return(0,d.jsxs)(n.U,{max:!0,justify:"between",className:(0,r.A)("",{},[a]),children:[(0,d.jsx)(S.zx,{onClick:u,children:s("Назад к списку")}),l&&(0,d.jsx)(S.zx,{onClick:g,children:s("Редактировать")})]})};var W={commentCard:"ghhhlnG6",username:"dw82WMzO",loading:"V0iZ1Un3"},_=s(9960),q=s(7050),V=s(516);const E=e=>{let{className:a,comment:s,isLoading:t}=e;return t?(0,d.jsxs)(n.g,{gap:"16",max:!0,className:(0,r.A)(W.commentCard,{},[a,W.loading]),children:[(0,d.jsxs)(n.g,{gap:"8",children:[(0,d.jsx)(q.O,{width:30,height:30,border:"50%"}),(0,d.jsx)(q.O,{className:W.username,width:100,height:16})]}),(0,d.jsx)(q.O,{className:W.text,width:"100%",height:50})]}):s?(0,d.jsxs)(n.U,{max:!0,gap:"16",className:(0,r.A)(W.commentCard,{},[a]),children:[(0,d.jsxs)(V.F,{to:(0,O.CJ)(s.user.id),children:[s.user.avatar&&(0,d.jsx)(_.q,{size:40,src:s.user.avatar}),(0,d.jsx)(c.xv,{className:W.username,title:s.user.username})]}),(0,d.jsx)(c.xv,{text:s.text})]}):null},F=e=>{let{className:a,comments:s,isLoading:t}=e;const{t:l}=(0,i.$)();return t?(0,d.jsxs)(n.g,{gap:"16",max:!0,className:(0,r.A)("",{},[a]),children:[(0,d.jsx)(E,{isLoading:!0}),(0,d.jsx)(E,{isLoading:!0}),(0,d.jsx)(E,{isLoading:!0})]}):(0,d.jsx)(n.g,{gap:"16",max:!0,className:(0,r.A)("",{},[a]),children:s?.length?s.map((e=>(0,d.jsx)(E,{isLoading:t,comment:e},e.id))):(0,d.jsx)(c.xv,{text:l("Комментарии отсутствуют")})})},H=(0,m.lazy)((()=>s.e(378).then(s.bind(s,2378)))),T=e=>e.articleDetailsPage?.comments?.isLoading||!1,$=(0,j.hg)("articleDetails/addCommentForArticle",(async(e,a)=>{const{extra:s,dispatch:i,getState:r,rejectWithValue:n}=a;try{const a=(0,U.m5)(r()),c=(0,t.wq)(r())?.id;if(!a||!e||!c)return n("no data");const l=await s.api.post("/comments",{articleId:c,userId:a.id,text:e});if(!l.data)throw new Error;return i(w(c)),l.data}catch(e){return console.log(e),n("error")}}));var M=s(9970),G=s(7568);const J=e=>{let{className:a,id:s}=e;const{t:t}=(0,i.$)(),l=(0,D.I0)(),o=(0,D.v9)(A.selectAll),x=(0,D.v9)(T),u=(0,m.useCallback)((e=>{l($(e))}),[]);return(0,M.Q)((()=>{l(w(s))})),(0,d.jsxs)(n.g,{gap:"16",max:!0,className:(0,r.A)("",{},[a]),children:[(0,d.jsx)(c.xv,{size:c.yH.L,title:t("Комментарии")}),(0,d.jsx)(m.Suspense,{fallback:(0,d.jsx)(G.a,{}),children:(0,d.jsx)(H,{onSendComment:u})}),(0,d.jsx)(F,{comments:o,isLoading:x})]})},K=(0,m.lazy)((()=>s.e(683).then(s.bind(s,8683)))),Q=e=>(0,d.jsx)(m.Suspense,{fallback:(0,d.jsx)(q.O,{width:"100%",height:120}),children:(0,d.jsx)(K,{...e})}),B={articleDetailsPage:b},Y=e=>{let{className:a,storybookId:s}=e;const{t:n}=(0,i.$)("article"),{id:c}=(0,x.UO)();return s?(0,d.jsx)(u.W,{reducers:B,removeAfterUnmount:!0,children:(0,d.jsxs)(g.T,{className:(0,r.A)(k,{},[a]),children:[(0,d.jsx)(R,{}),(0,d.jsx)(t.D0,{id:s,className:I}),(0,d.jsx)(Q,{articleId:s,className:I}),(0,d.jsx)(o,{className:I}),(0,d.jsx)(J,{id:s})]})}):c?(0,d.jsx)(u.W,{reducers:B,removeAfterUnmount:!0,children:(0,d.jsxs)(g.T,{className:(0,r.A)(k,{},[a]),children:[(0,d.jsx)(R,{}),(0,d.jsx)(t.D0,{id:c,className:I}),(0,d.jsx)(Q,{articleId:c,className:I}),(0,d.jsx)(o,{className:I}),(0,d.jsx)(J,{id:c})]})}):(0,d.jsx)("div",{className:(0,r.A)(k,{},[a]),children:n("Статья не найдена")})};var Z=(0,m.memo)(Y)}}]);