"use strict";(self.webpackChunkUlbiTV_frontend=self.webpackChunkUlbiTV_frontend||[]).push([[512],{11:function(e,a,r){r.d(a,{I:function(){return o}});var n=r(7294),t=r(3007),l={inputWrapper:"yiPASP1v",placeholder:"emAQQ85i",input:"LVdIPwcx",caretWrapper:"y1GiFC_L",caret:"lqMFGBuL",blink:"M7n8faAU",readonly:"fTN1PnWu"},s=r(5893);const o=(0,n.memo)((e=>{let{className:a,value:r="",onChange:o,type:i="text",placeholder:c,autoFocus:u,readonly:d,...h}=e;const[C,p]=(0,n.useState)(!1),[g,m]=(0,n.useState)(0),f=C&&!d,R=(0,n.useRef)(null);(0,n.useEffect)((()=>{u&&(p(!0),R.current?.focus())}),[u]);const v={[l.redonly]:d};return(0,s.jsxs)("div",{className:(0,t.A)(l.inputWrapper,v,[a]),children:[c&&(0,s.jsx)("div",{className:l.placeholder,children:`${c}>`}),(0,s.jsxs)("div",{className:l.caretWrapper,children:[(0,s.jsx)("input",{type:i,value:r,onChange:e=>{if(r?.toString().length>e?.target?.value?.length)return o?.(e.target.value),void m(e?.target?.selectionStart||0);o?.(e.target.value),m(e.target.value.length)},className:l.input,onFocus:()=>{p(!0)},onBlur:()=>{p(!1)},onSelect:e=>{m(e?.target?.selectionStart||0)},ref:R,readOnly:d,...h}),f&&(0,s.jsx)("span",{className:l.caret,style:{left:9*g+"px"}})]})]})}))},9512:function(e,a,r){r.r(a),r.d(a,{default:function(){return M}});let n=function(e){return e.Russia="Russia",e.Belarus="Belarus",e.Ukraine="Ukraine",e.Kazakhstan="Kazakhstan",e.Armenia="Armenia",e}({});var t=r(7294),l=r(5443),s=r(3007),o=r(964),i=r(5893);const c=[{value:n.Armenia,content:n.Armenia},{value:n.Belarus,content:n.Belarus},{value:n.Kazakhstan,content:n.Kazakhstan},{value:n.Russia,content:n.Russia},{value:n.Ukraine,content:n.Ukraine}],u=(0,t.memo)((e=>{let{className:a,value:r,onChange:n,readonly:u}=e;const{t:d}=(0,l.$)(),h=(0,t.useCallback)((e=>{n?.(e)}),[n]);return(0,i.jsx)(o.wb,{className:(0,s.A)("",{},[a]),defaultValue:d("Укажите страну"),label:d("Укажите страну"),items:c,value:r,readonly:u,onChange:h})}));let d=function(e){return e.RUB="RUB",e.EUR="EUR",e.USD="USD",e}({});const h=[{value:d.RUB,content:d.RUB},{value:d.EUR,content:d.EUR},{value:d.USD,content:d.USD}],C=(0,t.memo)((e=>{let{className:a,value:r,onChange:n,readonly:c}=e;const{t:u}=(0,l.$)(),d=(0,t.useCallback)((e=>{n?.(e)}),[n]);return(0,i.jsx)(o.wb,{className:(0,s.A)("",{},[a]),defaultValue:u("Укажите валюту"),label:u("Укажите валюту"),items:h,value:r,readonly:c,onChange:d,direction:"top right"})}));var p=r(9960),g=r(11),m=r(7568),f=r(8699),R={profilecard:"blbfbGnP",editBtn:"LGXZAu9G",loading:"t07ZxFGs",error:"i5YK3SSb",editing:"DjTe7269"},v=r(9457);const N=e=>{let{className:a,data:r,isLoading:n,error:t,readonly:o,onChangeFirstName:c,onChangeLastName:d,onChangeAge:h,onChangeCity:N,onChangeUsername:y,onChangeAvatar:x,onChangeCurrency:E,onChangeCountry:j}=e;const{t:A}=(0,l.$)("profile");if(n)return(0,i.jsx)(v.U,{justify:"center",max:!0,className:(0,s.A)(R.profilecard,{[R.loading]:!0},[a]),children:(0,i.jsx)(m.a,{})});if(t)return(0,i.jsx)(v.U,{justify:"center",max:!0,className:(0,s.A)(R.profilecard,{},[a,R.error]),children:(0,i.jsx)(f.xv,{title:A("Произошла ошибка при загрузке профиля"),text:A("Попробуйте перезагрузить страницу"),theme:f.lg.ERROR,align:f.PH.CENTER})});const U={[R.editing]:!o};return(0,i.jsxs)(v.g,{gap:"8",max:!0,className:(0,s.A)(R.profilecard,U,[a]),children:[r?.avatar&&(0,i.jsx)(v.U,{justify:"center",max:!0,children:(0,i.jsx)(p.q,{size:200,src:r?.avatar,alt:"avatar img"})}),(0,i.jsx)(g.I,{value:r?.first,placeholder:A("Ваше имя"),className:R.input,readonly:o,onChange:c}),(0,i.jsx)(g.I,{value:r?.lastname,placeholder:A("Ваше фамилия"),className:R.input,readonly:o,onChange:d}),(0,i.jsx)(g.I,{value:Number(r?.age)||0,placeholder:A("Ваш возраст"),className:R.input,readonly:o,onChange:h}),(0,i.jsx)(g.I,{value:r?.city,placeholder:A("Город"),className:R.input,readonly:o,onChange:N}),(0,i.jsx)(g.I,{value:r?.username,placeholder:A("Имя пользователя"),className:R.input,readonly:o,onChange:y}),(0,i.jsx)(g.I,{value:r?.avatar,placeholder:A("Введите ссылку на аватар"),className:R.input,readonly:o,onChange:x}),(0,i.jsx)(C,{className:R.input,value:r?.currency,onChange:E,readonly:o}),(0,i.jsx)(u,{className:R.input,value:r?.country,onChange:j,readonly:o})]})};var y=r(1992),x=r(1233),E=r(5401),j=r(9970),A=r(4268);const U=(0,A.hg)("profile/fetchProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n}=a;try{const a=await r.api.get(`/profile/${e}`);if(!a.data)throw new Error;return a.data}catch(e){return console.log(e),n("error")}}));let T=function(e){return e.INCORRECT_USER_DATA="INCORRECT_USER_DATA",e.INCORRECT_AGE="INCORRECT_AGE",e.INCORRECT_COUNTRY="INCORRECT_COUNTRY",e.NO_DATA="NO_DATA",e.SERVER_ERROR="SERVER_ERROR",e}({});const b=e=>e.profile?.form,O=(0,A.hg)("profile/updateProfileData",(async(e,a)=>{const{extra:r,rejectWithValue:n,getState:t}=a;try{const e=b(t()),a=(e=>{if(!e)return[T.NO_DATA];const{first:a,lastname:r,age:n,country:t}=e,l=[];return a&&r||l.push(T.INCORRECT_USER_DATA),n&&Number.isInteger(n)||l.push(T.INCORRECT_AGE),t||l.push(T.INCORRECT_COUNTRY),l})(e);if(a.length)return n(a);const l=await r.api.put(`/profile/${e?.id}`,e);if(!l.data)throw new Error;return l.data}catch(e){return console.log(e),n([T.SERVER_ERROR])}})),k=(0,A.oM)({name:"profile",initialState:{readonly:!0,isLoading:!1,error:void 0,data:void 0,form:void 0},reducers:{setReadonly:(e,a)=>{e.readonly=a.payload},cancelEdit:e=>{e.readonly=!0,e.form=e.data,e.validateErrors=void 0},updateProfile:(e,a)=>{e.form={...e.form,...a.payload}}},extraReducers:e=>{e.addCase(U.pending,(e=>{e.error=void 0,e.isLoading=!0})).addCase(U.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload})).addCase(U.rejected,((e,a)=>{e.error=a.payload,e.isLoading=!1})).addCase(O.pending,(e=>{e.validateErrors=void 0,e.isLoading=!0})).addCase(O.fulfilled,((e,a)=>{e.isLoading=!1,e.data=a.payload,e.form=a.payload,e.readonly=!0,e.validateErrors=void 0})).addCase(O.rejected,((e,a)=>{e.validateErrors=a.payload,e.isLoading=!1}))}}),{actions:_}=k,{reducer:I}=k,S=e=>e.profile?.error,L=e=>e.profile?.isLoading,D=e=>e.profile?.readonly,P=e=>e.profile?.validateErrors;var w=r(9499);const B=e=>e.profile?.data;var V=r(919);const $=e=>{let{className:a}=e;const{t:r}=(0,l.$)("profile"),n=(0,y.v9)(D),o=(0,y.v9)(V.m5),c=(0,y.v9)(B),u=o?.id===c?.id,d=(0,E.T)(),h=(0,t.useCallback)((()=>{d(_.setReadonly(!1))}),[d]),C=(0,t.useCallback)((()=>{d(_.cancelEdit())}),[d]),p=(0,t.useCallback)((()=>{d(O())}),[d]);return(0,i.jsxs)(v.U,{justify:"between",max:!0,className:(0,s.A)("",{},[a]),children:[(0,i.jsx)(f.xv,{title:r("Профиль")}),u&&(0,i.jsx)(i.Fragment,{children:n?(0,i.jsx)(w.zx,{theme:w.bn.OUTLINE,onClick:h,children:r("Редактировать")}):(0,i.jsxs)(v.U,{gap:"8",children:[(0,i.jsx)(w.zx,{theme:w.bn.OUTLINE,onClick:p,children:r("Сохранить")}),(0,i.jsx)(w.zx,{theme:w.bn.OUTLINE_RED,onClick:C,children:r("Отменить")})]})})]})},G={profile:I},F=e=>{let{className:a,id:r}=e;const{t:n}=(0,l.$)(),o=(0,y.v9)(b),c=(0,y.v9)(L),u=(0,y.v9)(S),d=(0,y.v9)(D),h=(0,E.T)(),C=(0,y.v9)(P),p={[T.INCORRECT_USER_DATA]:n("Имя и фамилия обязательны"),[T.INCORRECT_AGE]:n("Некорректный возраст"),[T.INCORRECT_COUNTRY]:n("Некорректный регион"),[T.SERVER_ERROR]:n("Ошибка сервера"),[T.NO_DATA]:n("Данные не указаны")};(0,j.Q)((()=>r&&h(U(r))));const g=(0,t.useCallback)((e=>{h(_.updateProfile({first:e||""}))}),[h]),m=(0,t.useCallback)((e=>{h(_.updateProfile({lastname:e||""}))}),[h]),R=(0,t.useCallback)((e=>{Number(e)&&h(_.updateProfile({age:Number(e)||0}))}),[h]),A=(0,t.useCallback)((e=>{h(_.updateProfile({city:e||""}))}),[h]),O=(0,t.useCallback)((e=>{h(_.updateProfile({username:e||""}))}),[h]),k=(0,t.useCallback)((e=>{h(_.updateProfile({avatar:e||""}))}),[h]),I=(0,t.useCallback)((e=>{h(_.updateProfile({currency:e}))}),[h]),w=(0,t.useCallback)((e=>{h(_.updateProfile({country:e}))}),[h]);return(0,i.jsx)(x.W,{reducers:G,removeAfterUnmount:!0,children:(0,i.jsxs)(v.g,{gap:"8",max:!0,className:(0,s.A)("",{},[a]),children:[(0,i.jsx)($,{}),C?.length&&C.map((e=>(0,i.jsx)(f.xv,{theme:f.lg.ERROR,text:p[e]},e))),(0,i.jsx)(N,{data:o,isLoading:c,error:u,readonly:d,onChangeFirstName:g,onChangeLastName:m,onChangeAge:R,onChangeCity:A,onChangeUsername:O,onChangeAvatar:k,onChangeCurrency:I,onChangeCountry:w})]})})};var W=r(9250),z=r(8979),M=(0,t.memo)((e=>{let{className:a}=e;const{id:r}=(0,W.UO)(),{t:n}=(0,l.$)();return(0,i.jsx)(z.T,{className:(0,s.A)("",{},[a]),children:(0,i.jsx)(v.g,{gap:"16",max:!0,children:(0,i.jsx)(F,{id:r})})})}))},1233:function(e,a,r){r.d(a,{W:function(){return s}});var n=r(7294),t=r(1992),l=r(5893);const s=e=>{const{children:a,reducers:r,removeAfterUnmount:s=!0}=e,o=(0,t.oR)(),i=(0,t.I0)();return(0,n.useEffect)((()=>{const e=o.reducerManager.getMountedReducers();return Object.entries(r).forEach((a=>{let[r,n]=a;e[r]||(o.reducerManager.add(r,n),i({type:`@INIT ${r} reducer`}))})),()=>{s&&Object.entries(r).forEach((e=>{let[a]=e;o.reducerManager.remove(a),i({type:`@DESTROY ${a} reducer`})}))}}),[]),(0,l.jsx)(l.Fragment,{children:a})}}}]);